<div *ngIf="mensaje" class="alert alert-success text-center my-3">
  {{ mensaje }}
</div>

<div class="container my-5">
    <div class="card p-4 shadow-lg border-0">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="h4 m-0 text-primary">Mis Ã“rdenes de Trabajo Asignadas ðŸš€</h2>
            </div>

        <div *ngIf="errorMessage" class="alert alert-danger mb-4">
            Error al cargar Ã³rdenes: {{ errorMessage }}
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="bg-light">
                    <tr>
                        <th>ID Orden</th>
                        <th>Cliente</th>
                        <th>DirecciÃ³n</th>
                        <th>Tipo</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let orden of ordenes">
                        <td>{{ orden.id_orden }}</td>
                        <td>{{ orden.cliente_nombre }} {{ orden.cliente_apellido }}</td>
                        <td>{{ orden.direccion_trabajo }}</td>
                        <td>{{ orden.tipo | uppercase }}</td>
                        <td>
                            <span class="badge" 
                                  [class.bg-warning]="orden.estado === 'asignada'" 
                                  [class.bg-primary]="orden.estado === 'en_proceso'"
                                  [class.bg-success]="orden.estado === 'completada'">
                                {{ obtenerNombreEstado(orden.estado) }} 
                            </span>
                        </td>
                        <td>
                            <button *ngIf="orden.estado === 'asignada'" 
                                    (click)="cambiarEstado(orden.id_orden, 'en_proceso')" 
                                    class="btn btn-sm btn-primary me-2">
                                Iniciar
                            </button>

                            <ng-container *ngIf="orden.estado === 'en_proceso'">
                                <button (click)="abrirModalFinalizar(orden)" 
                                        class="btn btn-sm btn-success me-2">
                                    Completar
                                </button>
                                <button (click)="cambiarEstado(orden.id_orden, 'cancelada')" 
                                        class="btn btn-sm btn-danger">
                                    Cancelar
                                </button>
                            </ng-container>

                            <span *ngIf="orden.estado === 'completada' || orden.estado === 'cancelada'" class="text-muted">Finalizada</span>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div *ngIf="ordenes.length === 0" class="alert alert-info text-center mt-3 border-0 shadow-sm">
                No tienes Ã³rdenes de trabajo asignadas o pendientes en este momento. âœ…
            </div>
        </div>
    </div>

    <div *ngIf="mostrarModal && ordenSeleccionada" class="modal-overlay">
        <div class="card p-5 shadow-2xl modal-content-centered">
            <h3 class="mb-4 text-center text-success">Reporte de Orden #{{ ordenSeleccionada.id_orden }}</h3>
            
            <form (ngSubmit)="confirmarFinalizar()">
                <div class="mb-3">
                    <label class="form-label">SoluciÃ³n o Trabajo Realizado (*):</label>
                    <textarea 
                        class="form-control" 
                        rows="4" 
                        [(ngModel)]="solucion_reclamo" 
                        name="solucion_reclamo" 
                        required>
                    </textarea>
                </div>
                
                
                <div *ngIf="solucion_reclamo.length < 5" class="text-danger small mt-1">
                    La descripciÃ³n de la soluciÃ³n es obligatoria al completar la orden.
                </div>

                <div class="mt-4 text-end">
                    <button type="button" (click)="cerrarModal()" class="btn btn-secondary me-2">Cancelar</button>
                    <button type="submit" 
                            class="btn btn-success"
                            [disabled]="solucion_reclamo.length < 5">
                        Completar Orden
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
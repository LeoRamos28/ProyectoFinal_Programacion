<div *ngIf="mensaje" class="alert alert-success text-center my-3">
  {{ mensaje }}
</div>

<!-- √çCONO DE NOTIFICACI√ìN  -->
<div
  class="notification-icon me-3 position-relative"
  (click)="mostrarAlertas = !mostrarAlertas"
  style="cursor: pointer; z-index: 1000"
>
  <i class="fa fa-bell fs-4 text-warning"></i>
  <span
    *ngIf="alertas.length > 0"
    class="badge bg-danger position-absolute top-0 start-100 translate-middle badge-pill border border-light rounded-pill"
    style="font-size: 0.7em"
  >
    {{ alertas.length }}
  </span>
</div>

<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üì¶ Gesti√≥n de Inventario</h2>
    <button class="btn btn-primary fw-bold" (click)="nuevoProducto()">
      <i class="fa fa-plus"></i> + Nuevo Material
    </button>
  </div>

  <div class="card shadow">
    <div class="card-body p-0">
      <table class="table table-hover table-striped mb-0">
        <thead class="bg-light">
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Descripci√≥n</th>
            <th class="text-center">Stock</th>
            <th>Unidad</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="cargando">
            <td colspan="6" class="text-center py-4">Cargando...</td>
          </tr>
          <tr *ngFor="let item of listaProductos">
            <td>{{ item.id_producto }}</td>
            <td class="fw-bold">{{ item.nombre }}</td>
            <td class="text-muted small">{{ item.descripcion }}</td>
            <td class="text-center">
              <span
                class="badge"
                [ngClass]="item.stock_actual <= item.stock_minimo ? 'bg-danger' : 'bg-success'"
              >
                {{ item.stock_actual }}
              </span>
            </td>
            <td>{{ item.unidad_medida }}</td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-primary me-2" (click)="editarProducto(item)">
                ‚úèÔ∏è
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="eliminar(item.id_producto)">
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ALERTAS -->

<div *ngIf="mostrarAlertas" class="mt-3">
  <div class="d-flex flex-column gap-2">
    <div
      *ngFor="let alerta of alertas"
      class="alert alert-warning alert-dismissible fade show mb-0 shadow-sm border-0 w-50"
      role="alert"
      style="cursor: pointer; white-space: nowrap"
    >
      <div class="d-flex align-items-center">
        <i class="fa fa-exclamation-triangle me-2 text-warning fs-5"></i>

        <div class="flex-grow-1">
          {{ obtenerTextoAlerta(alerta) }}
          <small class="text-muted d-block">{{ alerta.fecha_alerta | date : 'short' }}</small>
        </div>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="resolverAlerta(alerta.id_alerta); $event.stopPropagation()"
        ></button>
      </div>
    </div>

    <div *ngIf="alertas.length === 0" class="text-center text-muted p-3">
      ‚úÖ No hay alertas pendientes
    </div>
  </div>
</div>

<div *ngIf="mostrarModal" class="modal-overlay">
  <div class="card p-4 shadow-lg modal-content-centered">
    <h3 class="mb-4 text-center">
      {{ productoActual.id_producto ? 'Editar Material' : 'Nuevo Material' }}
    </h3>

    <form (ngSubmit)="guardar()">
      <div class="mb-3">
        <label class="form-label">Nombre del Material (*)</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="productoActual.nombre"
          name="nombre"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Descripci√≥n</label>
        <textarea
          class="form-control"
          rows="2"
          [(ngModel)]="productoActual.descripcion"
          name="descripcion"
        ></textarea>
      </div>

      <div class="row">
        <div class="col-6 mb-3">
          <label class="form-label">Stock Actual</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="productoActual.stock_actual"
            name="stock"
          />
        </div>
        <div class="col-4 mb-3">
          <label class="form-label">Stock m√≠nimo</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="productoActual.stock_minimo"
            name="stock_minimo"
          />
        </div>
        <div class="col-6 mb-3">
          <label class="form-label">Unidad</label>
          <select class="form-select" [(ngModel)]="productoActual.unidad_medida" name="unidad">
            <option value="Unidades">Unidades</option>
            <option value="Metros">Metros</option>
            <option value="Cajas">Cajas</option>
            <option value="Bobinas">Bobinas</option>
          </select>
        </div>
      </div>

      <div class="mt-4 text-end">
        <button type="button" (click)="cerrarModal()" class="btn btn-danger me-2 fw-bold">
          Cancelar
        </button>
        <button type="submit" class="btn btn-success fw-bold">
          {{ productoActual.id_producto ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</div>

<div *ngIf="mensaje" class="alert alert-success shadow-sm mb-4 mx-2">
  {{ mensaje }}
</div>

<div class="container-fluid px-2 px-md-4 my-4">
  <div class="card shadow-sm border-0">
    <div class="card-body p-3 p-md-4">
      <h2 class="h4 mb-0 fw-bold text-secondary text-center">Gesti√≥n de T√©cnicos üõ†Ô∏è</h2>
      <br />

      <div
        class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3"
      >
        <button
          (click)="agregarTecnico()"
          class="btn btn-primary w-100 w-md-auto rounded-pill px-4 shadow-sm fw-bold py-2"
        >
          + Nuevo T√©cnico
        </button>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger mb-4">
        {{ errorMessage }}
      </div>

      <div class="table-responsive rounded-3 border">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-dark">
            <tr>
              <th class="d-none d-md-table-cell ps-3">ID</th>
              <th>T√©cnico</th>
              <th class="d-none d-lg-table-cell">Email</th>
              <th class="text-center">Estado</th>
              <th class="text-end pe-3">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tecnico of tecnicos">
              <td class="d-none d-md-table-cell ps-3 text-muted">#{{ tecnico.id_usuario }}</td>
              <td>
                <div class="fw-bold">{{ tecnico.nombre }} {{ tecnico.apellido }}</div>
                <div class="d-lg-none small text-muted text-truncate" style="max-width: 150px">
                  {{ tecnico.email }}
                </div>
              </td>
              <td class="d-none d-lg-table-cell text-muted">{{ tecnico.email }}</td>
              <td class="text-center">
                <span
                  class="badge rounded-pill px-3 py-2"
                  [class.bg-success]="tecnico.estado"
                  [class.bg-secondary]="!tecnico.estado"
                >
                  {{ tecnico.estado ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td class="text-end pe-3 text-nowrap">
                <button (click)="editarTecnico(tecnico)" class="btn btn-sm btn-light border me-1">
                  ‚úèÔ∏è
                </button>
                <button
                  (click)="eliminarTecnico(tecnico.id_usuario)"
                  class="btn btn-sm btn-light border text-danger"
                >
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="tecnicos.length === 0" class="p-5 text-center text-muted">
          <i class="bi bi-person-badge fs-1 d-block mb-2 opacity-50"></i>
          No hay t√©cnicos registrados.
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="mostrarFormulario && tecnicoSeleccionado" class="modal-overlay px-2">
  <div class="card shadow-lg modal-content-centered border-0 overflow-hidden">
    <div class="bg-dark p-3 text-white text-center">
      <h3 class="h5 mb-0">
        {{ tecnicoSeleccionado.id_usuario === 0 ? 'Registrar' : 'Editar' }} T√©cnico
      </h3>
    </div>

    <div class="p-3 p-md-4 scroll-container">
      <form (ngSubmit)="guardarTecnico()">
        <div class="row g-3">
          <div class="col-6">
            <label class="form-label small fw-bold">Nombre</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="tecnicoSeleccionado.nombre"
              name="nombre"
              required
            />
          </div>
          <div class="col-6">
            <label class="form-label small fw-bold">Apellido</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="tecnicoSeleccionado.apellido"
              name="apellido"
              required
            />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label small fw-bold">Email Institucional</label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="tecnicoSeleccionado.email"
              name="email"
              required
            />
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label small fw-bold">DNI</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="tecnicoSeleccionado.dni"
              name="dni"
              required
            />
          </div>

          <div class="col-12" *ngIf="tecnicoSeleccionado.id_usuario === 0">
            <label class="form-label small fw-bold">Contrase√±a Temporal</label>
            <input
              type="password"
              class="form-control"
              [(ngModel)]="tecnicoSeleccionado.password"
              name="password"
              required
            />
          </div>

          <div class="col-7 col-md-8">
            <label class="form-label small fw-bold">Tel√©fono de Contacto</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="tecnicoSeleccionado.telefono"
              name="telefono"
            />
          </div>

          <div class="col-5 col-md-4 d-flex flex-column justify-content-end pb-1">
            <label class="form-label small fw-bold mb-2">Estado</label>
            <div class="form-check form-switch pt-1">
              <input
                class="form-check-input"
                type="checkbox"
                id="estadoSwitch"
                [(ngModel)]="tecnicoSeleccionado.estado"
                name="estado"
              />
              <label class="form-check-label small" for="estadoSwitch">
                {{ tecnicoSeleccionado.estado ? 'Activo' : 'Inactivo' }}
              </label>
            </div>
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button
            type="button"
            (click)="mostrarFormulario = false"
            class="btn btn-danger border flex-fill fw-bold"
          >
            Cancelar
          </button>

          <button type="submit" class="btn btn-success flex-fill fw-bold shadow-sm">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>

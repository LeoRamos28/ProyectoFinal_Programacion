<div class="container my-4">
  <h2 class="mb-4">Panel de control</h2>

  <div *ngIf="mensajeError" class="alert alert-danger">
    {{ mensajeError }}
  </div>
  <div *ngIf="rolUsuario === 1" class="row mb-4">
    <div class="col-md-3 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-clientes-activos"
        (click)="mostrarDetalle('clientes'); verClientes()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Clientes activos</div>
          <div class="display-6 fw-bold">{{ totalClientes }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-usuarios-registrados"
        (click)="mostrarDetalle('usuarios'); verUsuarios()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Usuarios registrados</div>
          <div class="display-6 fw-bold">{{ totalUsuarios }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-ordenes-totales"
        (click)="mostrarDetalle('ordenesTotales'); verOrdenesTotales()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Todas las órdenes</div>
          <div class="display-6 fw-bold">{{ totalOrdenesSistema }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-stock-bajo"
        (click)="mostrarDetalle('stock'); verStockBajo()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Items con stock bajo</div>
          <div class="display-6 fw-bold">{{ stockBajo }}</div>
        </div>
      </div>
    </div>
  </div>
  <!-- TARJETAS TÉCNICO -->
  <div *ngIf="rolUsuario === 2" class="row mb-4">
    <div class="col-md-4 mb-3" *ngFor="let o of ordenesPorEstadoTecnico">
      <div
        class="card text-white h-100 shadow card-styled"
        (click)="
          mostrarDetalle(o.estado === 'pendiente' ? 'ordenesTecnicoPendientes' : 'ordenesTecnico');
          o.estado === 'pendiente'
            ? verOrdenesTecnicoPendientes()
            : o.estado === 'en_proceso'
            ? verOrdenesTecnicoEnProceso()
            : o.estado === 'asignada'
            ? verOrdenesTecnicoAsignadas()
            : o.estado === 'cancelada'
            ? verOrdenesTecnicoCanceladas()
            : verOrdenesTecnicoFinalizadas()
        "
        [ngClass]="{
          'card-pendiente': o.estado === 'pendiente',
          'card-en-proceso': o.estado === 'en_proceso',
          'card-cancelada': o.estado === 'cancelada',
          'card-asignada': o.estado === 'asignada',
          'card-finalizada': o.estado === 'finalizada' || o.estado === 'completada'
        }"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Órdenes {{ o.estado }}</div>
          <div class="display-6 fw-bold">
            {{ o.estado === 'pendiente' ? ordenesPendientesTecnico : o.cantidad }}
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div
        class="card text-white h-100 shadow card-styled card-reclamos"
        (click)="mostrarDetalle('reclamosTecnico'); verReclamosTecnico()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Reclamos pendientes</div>
          <div class="display-6 fw-bold">{{ reclamosAbiertos }}</div>
        </div>
      </div>
    </div>
  </div>
  <!-- TARJETAS ATENCIÓN -->
  <div *ngIf="rolUsuario === 3" class="row mb-4">
    <div class="col-md-4 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-clientes-activos"
        (click)="mostrarDetalle('clientes'); verClientes()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Clientes activos</div>
          <div class="display-6 fw-bold">{{ totalClientes }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-reclamos-ventas"
        (click)="mostrarDetalle('reclamosAtencion'); verReclamosAtencion()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Reclamos abiertos</div>
          <div class="display-6 fw-bold">{{ reclamosAbiertos }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div
        class="card text-white h-100 shadow card-styled color-solicitudes-pendientes"
        (click)="mostrarDetalle('solicitudesPendientes'); verSolicitudesPendientes()"
        style="cursor: pointer"
      >
        <div class="card-body">
          <div class="card-title fs-5">Solicitudes pendientes</div>
          <div class="display-6 fw-bold">{{ ordenesPendientesAtencion }}</div>
        </div>
      </div>
    </div>
  </div>
  <!-- DETALLES MASTER -->
  <div *ngIf="tarjetaSeleccionada === 'clientes'" class="mt-4">
    <h4>Clientes activos</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Provincia</th>
          <th>Localidad</th>
          <th>Fecha alta</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of detalleClientes">
          <td>{{ c.id_cliente }}</td>
          <td>{{ c.nombre }} {{ c.apellido }}</td>
          <td>{{ c.provincia }}</td>
          <td>{{ c.localidad }}</td>
          <td>{{ c.fecha_alta | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="tarjetaSeleccionada === 'usuarios'" class="mt-4">
    <h4>Usuarios registrados</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Rol</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of detalleUsuarios">
          <td>{{ u.id_usuario }}</td>
          <td>{{ u.nombre }} {{ u.apellido }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.rol?.nombre || u.id_rol }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- TABLA -->
  <div *ngIf="tarjetaSeleccionada === 'stock'" class="mt-4">
    <h4>Items con stock bajo</h4>

    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Stock actual</th>
          <th>Stock mínimo</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of detalleStock">
          <td>{{ s.id_producto }}</td>
          <td>{{ s.nombre }}</td>
          <td>{{ s.stock_actual }}</td>
          <td>{{ s.stock_minimo }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ORDENES TOTALES -->
  <div *ngIf="tarjetaSeleccionada === 'ordenesTotales'" class="mt-4">
    <h4>Todas las órdenes del sistema</h4>

    <!-- FILTROS -->
    <div class="row mb-3">
      <div class="col-md-3">
        <label class="form-label">Filtrar por tipo:</label>
        <select class="form-select" [(ngModel)]="filtroTipo" (change)="aplicarFiltros()">
          <option value="">Todos</option>
          <option value="instalacion">Instalación</option>
          <option value="reclamo">Reclamo</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Filtrar por estado:</label>
        <select class="form-select" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
          <option value="">Todos</option>
          <option value="pendiente">Pendiente</option>
          <option value="asignada">Asignada</option>
          <option value="en_proceso">En proceso</option>
          <option value="finalizada">Finalizada</option>
          <option value="cancelada">Cancelada</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Buscar por cliente:</label>
        <input
          type="text"
          class="form-control"
          placeholder="Nombre o apellido"
          [(ngModel)]="filtroCliente"
          (input)="aplicarFiltros()"
        />
      </div>
    </div>

    <!-- TABLA ORDENES -->
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Cliente</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Fecha creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of detalleOrdenesFiltrado">
          <td>{{ o.id_orden }}</td>
          <td>{{ o.cliente?.nombre }} {{ o.cliente?.apellido }}</td>
          <td>{{ o.tipo }}</td>
          <td>{{ o.estado }}</td>
          <td>{{ o.fecha_creacion | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- DETALLES TÉCNICO -->
  <div *ngIf="tarjetaSeleccionada === 'ordenesTecnico'" class="mt-4">
    <h4>Órdenes del técnico</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Fecha creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of detalleOrdenesTecnico">
          <td>{{ o.id_orden }}</td>
          <td>{{ o.tipo }}</td>
          <td>{{ o.estado }}</td>
          <td>{{ o.fecha_creacion | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="tarjetaSeleccionada === 'ordenesTecnicoPendientes'" class="mt-4">
    <h4>Órdenes pendientes del técnico</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Tipo</th>
          <th>Descripción</th>
          <th>Estado</th>
          <th>Fecha creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of detalleOrdenesTecnicoPendientes">
          <td>{{ o.id_orden }}</td>
          <td>{{ o.tipo }}</td>
          <td>{{ o.descripcion }}</td>
          <td>{{ o.estado }}</td>
          <td>{{ o.fecha_creacion | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="tarjetaSeleccionada === 'reclamosTecnico'" class="mt-4">
    <h4>Reclamos del técnico</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Tipo</th>
          <th>Descripción</th>
          <th>Estado</th>
          <th>Fecha creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of detalleReclamosTecnico">
          <td>{{ r.id_orden }}</td>
          <td>{{ r.tipo }}</td>
          <td>{{ r.descripcion }}</td>
          <td>{{ r.estado }}</td>
          <td>{{ r.fecha_creacion | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- DETALLES ATENCIÓN -->
  <div *ngIf="tarjetaSeleccionada === 'reclamosAtencion'" class="mt-4">
    <h4>Reclamos abiertos</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Cliente</th>
          <th>Descripción</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Fecha creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of detalleReclamosAtencion">
          <td>{{ r.id_orden }}</td>
          <td>{{ r.cliente?.nombre }} {{ r.cliente?.apellido }}</td>
          <td>{{ r.descripcion }}</td>
          <td>{{ r.tipo }}</td>
          <td>{{ r.estado }}</td>
          <td>{{ r.fecha_creacion | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="tarjetaSeleccionada === 'solicitudesPendientes'" class="mt-4">
    <h4>Solicitudes pendientes</h4>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Cliente</th>
          <th>Descripción</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Fecha creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of detalleSolicitudesPendientes">
          <td>{{ s.id_orden }}</td>
          <td>{{ s.cliente?.nombre }} {{ s.cliente?.apellido }}</td>
          <td>{{ s.descripcion }}</td>
          <td>{{ s.tipo }}</td>
          <td>{{ s.estado }}</td>
          <td>{{ s.fecha_creacion | date : 'short' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
